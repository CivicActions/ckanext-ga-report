{% extends "page.html" %}
{% import "/ga_report/ga_util_jinja.html" as m with context %}

{% block title %}Site Usage - {{ super() }}{% endblock %}

{% block header %}
  <link rel="stylesheet" type="text/css" href="/css/ga_report.css?1"/>
  <script  src="https://code.jquery.com/jquery-1.3.min.js" integrity="sha256-kAGRpEMRXYtIqdaNMGLos9cSlyeVG4YXRltIW68lMAY=" crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  {% resource 'scripts/scripts/temp.js' %}
  {% resource 'scripts/scripts/chart.js' %}
  {% resource 'scripts/scripts/nav.js' %}
  {% resource 'scripts/css/chart.css' %}
  {% resource 'scripts/css/nav.css' %}
  {% include "header.html" %}
{% endblock %}


{% block breadcrumb_content %}
    <li><a href="/data/site-usage">Site Analytics</a></li>
    <li><a href="/data/site-usage">Site-wide</a></li>
{% endblock %}

{% block primary_content %}
  <div class="col-sm-12 top_row">
    <h1 class="site_title">Site Usage Analytics</h1>
    <p>The information on this page displays Google Analytic statistics about the usage of the United States Data.gov site, where metadata of open resources are stored.</p>
  </div>
  <div class="tab">
    <button class="tablinks"  onclick="openTab(event, 'total_traffic')">Total Traffic</button>
    <button class="tablinks" id="defaultOpen" onclick="openTab(event, 'page_views', 'chart1')">Page Views</button>
    <button class="tablinks" onclick="openTab(event, 'page_avgTime', 'chart2')">Average Time on Page</button>
    <button class="tablinks" onclick="openTab(event, 'time_on_page', 'chart6')">Total Time on Page</button>
    <button class="tablinks" onclick="openTab(event, 'landing_page','chart3')">Landing Pages</button>
    <button class="tablinks" onclick="openTab(event, 'second_page','chart4')">Second Pages</button>
    <button class="tablinks" onclick="openTab(event, 'third_page','chart5')">Third Pages</button>
    <button class="tablinks" onclick="openTab(event, 'exit_page','chart7')">Exit Pages</button>
    <button class="tablinks" onclick="openTab(event, 'browsers_names')">Browswer Names</button>
    <button class="tablinks" onclick="openTab(event, 'browser_sizes')">Screen Sizes</button>
    <button class="tablinks" onclick="openTab(event, 'device_category')">Device Category</button>
    <button class="tablinks" onclick="openTab(event, 'os')">Operating Systems</button>
    <button class="tablinks" onclick="openTab(event, 'social_networks')">Social Networks</button>
    <button class="tablinks" onclick="openTab(event, 'languages')">Languages</button>
    <button class="tablinks" onclick="openTab(event, 'country')">Country</button>
    <button class="tablinks" onclick="openTab(event, 'region')">Region</button>
    <button class="tablinks" onclick="openTab(event, 'metro')">Metro</button>
  </div>
  <div class="" >
    <div class="enclosing_body col-md-8 col-sm-10">
      <div class="tabcontent" id="total_traffic">
        <h1 class="titles">Total Traffic</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Name</th>
            <th class="td-numeric">Value</th>
          </tr>
          {% for name, value in c.global_totals %}
          <tr>
            <td>{{name}}</td>
            <td class="td-numeric">{{value}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="page_views">
	<form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<h1 class="titles">Top Pages by Page Views</h1>
	<div class="charts" id="chart1"></div>
	<script>
	$(function() {
	  barChart({{c.page_views_chart|safe}},'Most Popular','views',"#chart1",true)
	});
	</script>
	<br>	
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Page</th>
            <th class="td-numeric">Views</th>
          </tr>
          {% for page, views in c.page_views %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{views}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="page_avgTime">
	<form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        <h1 class="titles">Highest Average Time On Page</h1>
	<div class="charts" id="chart2"></div>
        <script>
        $(function() {
          barChart({{c.page_avgTime_chart|safe}},'Most Popular','seconds',"#chart2",true)
        });
        </script>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Page</th>
            <th class="td-numeric">Time (seconds)</th>
          </tr>
          {% for page, avgTime in c.page_avgTime %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{avgTime|round|int}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="landing_page">
	<form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        <h1 class="titles">First Page Visited</h1>
        <div class="charts" id="chart3"></div>
        <script>
        $(function() {
          barChart({{c.landing_page_chart|safe}},'Most Popular','entrances',"#chart3",true)
        });
	</script>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Landing Page</th>
            <th class="td-numeric">Entrances</th>
          </tr>
          {% for page, entrances in c.landing_page %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{entrances}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="second_page">
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<h1 class="titles">Second Page Visited</h1>
	<div class="charts" id="chart4"></div>
	<h4>* Data shows top pages for pages that were the second page to be visited during a session</h4>
        <script>
        $(function() {
          barChart({{c.second_page_chart|safe}},'Most Popular','entrances',"#chart4",true)
        });
        </script>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Page</th>
            <th class="td-numeric">Views</th>
          </tr>
          {% for page, views in c.second_page %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{views}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="third_page">
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<h1 class="titles">Third Page Visited</h1>
	<div class="charts" id="chart5"></div>
        <h4>* Data shows top pages for pages that were the third page to be visited during a session</h4>	
	<script>
        $(function() {
          barChart({{c.third_page_chart|safe}},'Most Popular','entrances',"#chart5",true)
        });
        </script>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Page</th>
            <th class="td-numeric">Views</th>
          </tr>
          {% for page, views in c.third_page %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{views}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="exit_page">
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<h1 class="titles">Exit Page Exits</h1>
	<div class="charts" id="chart7"></div>
        <script>
        $(function() {
          barChart({{c.exit_page_chart|safe}},'Exit page','exits',"#chart7",true)
        });
        </script>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Exit Page</th>
            <th class="td-numeric">Exits</th>
          </tr>
          {% for page, exits in c.exit_page %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{exits}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div class="tabcontent" id="time_on_page">
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<h1 class="titles">Total Time On Page</h1>
	<div class="charts" id="chart6"></div>
	<script>
        $(function() {
          barChart({{c.time_on_page_chart|safe}},'Time on page','seconds',"#chart6",true)
        });
        </script>
        <table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Page</th>
            <th class="td-numeric">Time(s)</th>
          </tr>
          {% for page, timeOn in c.third_page %}
          <tr>
            <td><a href="https://{{page}}" target="_blank">{{page}}</a></td>
            <td class="td-numeric">{{timeOn}}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      {# <div class="" id="browsers_versions">
	<h2>User Browser Versions</h2>
        <p>*Browsers with a large number of versions have been grouped together.</p>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.browser_versions)}}
      </div>#}
      <div class="tabcontent" id="browsers_names">
	<h1 class="titles">User Browser Names</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.browsers)}}
      </div>
      <div class="tabcontent" id="browser_sizes">
        <h1 class="titles">User Browser/Screen Sizes</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.browser_sizes)}}
      </div>
      <div class="tabcontent" id="device_category">
        <h1 class="titles">User Devices</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.device_category)}}
      </div>
      <div class="tabcontent" id="os">
	<h1 class="titles">User Operating Systems</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.os)}}
      </div>
      <div class="tabcontent" id="os">
        <h1 class="titles">Mobile Brands</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.mobile_brands)}}
      </div>
      <div class="tabcontent" id="os">
        <h1 class="titles">Mobile devices</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.mobile_devices)}}
      </div>
      {# <div class="" id="os_versions">
	<h2>User Operating System Versions</h2>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
          {{m.stat_table(c.os_versions)}}
      </div> 
      <div class="tabcontent" id="social_referrals_totals">
        <p>*Number of visits that were referred from social networks</p>
        <form class="form-inline" action=""{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}"" method="get">
        <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<h1>Social Referrals Totals</h1>
	<div class="charts" id="chart6"></div>
        <script>
        $(function() {
          barChart({{c.social_referrals_totals_chart|safe}},'Time on page','visits',"#chart6",true)
        });
        </script>
        {{m.social_table(c.social_referrer_totals)}}
      </div> 
      <div class="" id="Referral Paths">
        <h2>Referral Paths</h2>
        <p>Percentage of visits that were referred from these social networks</p>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
	<table class="ga-reports-table table table-condensed table-bordered table-striped">
          <tr>
            <th>Path</th>
            <th class="td-numeric">Value</th>
          </tr>
          {% for path, value in c.referral_sources %}
          <tr>
            <td>{{path}}</td>
            <td class="td-numeric">{{value}}</td>
          </tr>
          {% endfor %}
      </table>
      </div> #} 
      <div class="tabcontent" id="social_networks">
	<h1 class="titles">Social Networks Referal Percentages</h1>
        <p>Percentage of visits that were referred from these social networks</p>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
          {{m.stat_table(c.social_networks, 'Visits')}}
      </div> 
      <div class="tabcontent" id="languages">
	<h1>Languages</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
          {{m.stat_table(c.languages)}}
      </div>
      <div class="tabcontent" id="country">
	<h1 class="titles">Country</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.country)}}
      </div>
      <div class="tabcontent" id="region">
        <h1 class="titles">Region</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.region)}}
      </div>
      <div class="tabcontent" id="metro">
        <h1 class="titles">Metro</h1>
        <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
          <h4 class="ga-reports-heading">Show stats table for:</h4>
          {{m.month_selector(c.month, c.months, c.day)}}
        </form>
        {{m.stat_table(c.metro)}}
      </div>
    </div>
  </div>
{% endblock %}

{% block secondary_content %}
  {% with download_link=h.url_for(controller='ckanext.ga_report.controller:GaReport',action='csv',month=c.month or 'all') %}
    <a class="btn button btn-primary btn-sm download_button" href="{{download_link}}"><i class="icon-download"></i>&nbsp; Download as CSV</a>
  {% endwith %}
    <a class="btn button btn-primary btn-sm download_button" href="/data/site-usage/publisher">Publisher Usage Statistics</a>
    <a class="btn button btn-primary btn-sm download_button" href="/data/site-usage/dataset">Dataset Usage Statistics</a>  
{% endblock %}
